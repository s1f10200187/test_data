カテゴリ
テストケース
条件 / 想定エラー
期待結果
正常系
1回目で成功
通常取得成功
リトライせず成功
正常系
2回目で成功
1回目失敗 → 2回目成功
リトライが正しく動作し、成功する
正常系
3回目で成功
1・2回目失敗 → 3回目成功
最大3回の範囲で成功する
正常系
成功時の待機時間
1回目失敗 → 2回目実行
2回目実行まで3秒待機していること
異常系
全て失敗
3回連続失敗
例外を投げる / エラーログを出力
異常系
接続タイムアウト
ConnectTimeout
リトライ対象になる
異常系
読み込みタイムアウト
ReadTimeout
リトライ対象になる
異常系
一時的 HTTP エラー
HTTP 503 / 504
リトライ対象になる
異常系
恒久的 HTTP エラー
HTTP 404 / 403
リトライせず即失敗（要件次第）
異常系
ネットワーク切断
ConnectionError
リトライ対象になる
リトライ制御
リトライ回数制御
常に失敗
最大3回までで終了する
リトライ制御
待機時間検証
モック時間利用
各リトライ間隔が3秒であること
リトライ制御
ログ出力
リトライ時
WARN/ERROR ログが正しく出力される
配置処理
部分成功時
複数画像のうち一部失敗
処理継続可否を確認
配置処理
フォールバック確認
取得失敗時に代替画像を使用
ダミー画像や既定値を配置
配置処理
既存キャッシュ利用
同名ファイルが既に存在
失敗時にキャッシュ利用可否を確認
運用観点
大量アクセス時
画像数が多く失敗多発
全体のスループットが落ちすぎないこと
運用観点
S3 制限
短時間で多数リトライ
レート制限にかからないこと
運用観点
監視 / ログ
失敗時

